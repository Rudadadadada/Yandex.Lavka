# ШБР Лето 2023. Вступительное задание

## Компоненты сервиса

1) REST API сервиса;
2) расчет рейтинга курьеров;
3) rate limiter для сервиса;
4) алгоритм распределения заказов по курьерам.

## REST API

В качестве базовой функциональности сервиса реализовано 7 базовых методов.

### POST /couriers

Обработчик принимает на вход список в формате json с данными о курьерах и графиком их работы.

Курьеры работают только в заранее определенных районах, а также различаются по типу: пеший, велокурьер и
курьер на автомобиле. От типа зависит объем заказов, которые перевозит курьер.
Районы задаются целыми положительными числами. График работы задается списком строк формата `HH:MM-HH:MM`.

### GET /couriers/{courier_id}

Возвращает информацию о курьере.

### GET /couriers

Возвращает информацию о всех курьерах.

У метода есть параметры `offset` и `limit`, чтобы обеспечить постраничную выдачу.
Если:

* `offset` или `limit` не передаются, по умолчанию нужно считать, что `offset = 0`, `limit = 1`;
* офферов по заданным `offset` и `limit` не найдено, нужно возвращать пустой список `couriers`.

### POST /orders

Принимает на вход список с данными о заказах в формате json. У заказа отображаются характеристики — вес, район,
время доставки и цена.
Время доставки - строка в формате HH:MM-HH:MM, где HH - часы (от 0 до 23) и MM - минуты (от 0 до 59).

### GET /orders/{order_id}

Возвращает информацию о заказе по его идентификатору, а также дополнительную информацию: вес заказа, район доставки,
промежутки времени, в которые удобно принять заказ.

### GET /orders

Возвращает информацию о всех заказах, а также их дополнительную информацию: вес заказа, район доставки, промежутки
времени, в которые удобно принять заказ.

У метода есть параметры `offset` и `limit`, чтобы обеспечить постраничную выдачу.
Если:

* `offset` или `limit` не передаются, по умолчанию нужно считать, что `offset = 0`, `limit = 1`;
* офферов по заданным `offset` и `limit` не найдено, нужно возвращать пустой список `orders`.

### POST /orders/complete

Принимает три параметра: id курьера, id заказа и время выполнения заказа, после отмечает, что заказ выполнен.

Обработчик идемпотентен.

## Рейтинг курьеров

Реализован метод `GET /couriers/meta-info/{courier_id}`.

Параметры метода:

* `start_date` - дата начала отсчета рейтинга
* `end_date` - дата конца отсчета рейтинга.

Метод возвращает заработанные курьером деньги за заказы и его рейтинг по определенным формулам.

## Rate limiter

Сделано с использованием библиотеки sloawapi. RPS = 10 на каждую ручку.

Конфигурации rate limiter находятся в файле ``app/limiter``

````
limiter = Limiter(key_func=get_remote_address) 
LIMIT = "10/second"
````
## Распределение заказов

Реализовано распределение заказов между курьерами для минимизации стоимости доставки.

* метод распределения заказов `POST /orders/assign`. Перед началом рабочего дня
  берем список заказов и распределяем их по доступным курьерам
* метод получения уже распределенных заказов `GET /couriers/assignments`

## Запуск:

1. Чтобы собрать Dockerfile нужно воспользоваться командой:

``docker build . -t app:latest``

2. Чтобы собрать и запустить docker-compose нужно воспользоваться командой:

``docker compose up -d --build``